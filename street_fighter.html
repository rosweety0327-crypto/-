<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>é ˜ä¸»æ ¼é¬¥ï¼šé€£ç·šå¿«æ‰“</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #1a1a1a; color: white; text-align: center; font-family: sans-serif; overflow: hidden; }
        #game-stage { width: 800px; height: 400px; background: linear-gradient(to bottom, #333, #000), url('https://www.transparenttextures.com/patterns/dark-matter.png'); margin: 20px auto; position: relative; border: 4px solid #f39c12; border-radius: 10px; box-shadow: 0 0 20px rgba(243, 156, 18, 0.3); }
        .player { width: 70px; height: 130px; position: absolute; bottom: 10px; transition: transform 0.1s; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; }
        #p1 { background: #ff4757; box-shadow: 0 0 15px #ff4757; }
        #p2 { background: #58a6ff; box-shadow: 0 0 15px #58a6ff; }
        .hp-bar { width: 350px; height: 25px; background: #444; border: 2px solid #fff; position: absolute; top: 20px; border-radius: 13px; overflow: hidden; }
        #hp1-fill { height: 100%; background: #2ecc71; width: 100%; transition: width 0.3s; }
        #hp2-fill { height: 100%; background: #2ecc71; width: 100%; transition: width 0.3s; }
        .controls { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 10px; display: inline-block; margin-top: 10px; }
        .effect { position: absolute; color: #f1c40f; font-weight: bold; font-size: 30px; text-shadow: 2px 2px #000; animation: hitAnim 0.5s forwards; pointer-events: none; }
        @keyframes hitAnim { from { opacity:1; transform:translateY(0) scale(1.2); } to { opacity:0; transform:translateY(-60px) scale(1); } }
    </style>
</head>
<body>
    <h2>ğŸ¥Š é ˜ä¸»æ ¼é¬¥ï¼šé€£ç·šå°æˆ°ç‰ˆ</h2>
    
    <div style="margin-bottom: 15px;">
        <span>æˆ‘çš„é€£ç·š ID: <b id="my-id" style="color:#f39c12;">è®€å–ä¸­...</b></span>
        <input type="text" id="target-id" placeholder="è¼¸å…¥å°æ‰‹ ID" style="padding:5px; margin-left:10px;">
        <button onclick="connect()" style="padding:5px 15px; cursor:pointer;">é€£ç·šæŒ‘æˆ°</button>
    </div>

    <div id="game-stage">
        <div class="hp-bar" style="left:20px;"><div id="hp1-fill"></div></div>
        <div class="hp-bar" style="right:20px;"><div id="hp2-fill"></div></div>
        
        <div id="p1" class="player">é ˜ä¸» (P1)</div>
        <div id="p2" class="player">å°æ‰‹ (P2)</div>
    </div>

    <div class="controls">
        ğŸ® <b>æ“ä½œèªªæ˜ï¼š</b> ç§»å‹• [A] [D] | æ”»æ“Š [G] | <span style="color:#f1c40f;">é€£ç·šå¾Œå¯é ç«¯å°æˆ°</span>
    </div>

    <script>
        // åˆå§‹åŒ–é€£ç·š
        const peer = new Peer(Math.floor(1000 + Math.random() * 9000).toString());
        let conn, isHost = true;
        let p1x = 100, p2x = 100; // p2x æ˜¯å¾å³é‚Šç®—éä¾†çš„è·é›¢
        let hp1 = 100, hp2 = 100;

        peer.on('open', id => document.getElementById('my-id').innerText = id);
        
        // æˆ¿ä¸»æ¨¡å¼ï¼šç­‰å¾…åˆ¥äººé€£ç·š
        peer.on('connection', c => {
            conn = c;
            isHost = true;
            setupConn();
            alert("å°æ‰‹å·²é€£ç·šï¼ä½ æ˜¯ [ç´…è‰²é ˜ä¸»]");
        });

        // æŒ‘æˆ°è€…æ¨¡å¼ï¼šä¸»å‹•é€£ç·š
        function connect() {
            const tid = document.getElementById('target-id').value;
            if(!tid) return alert("è«‹è¼¸å…¥ ID");
            conn = peer.connect(tid);
            isHost = false;
            setupConn();
            alert("å·²é€£ç·šï¼ä½ æ˜¯ [è—è‰²å°æ‰‹]");
        }

        function setupConn() {
            conn.on('data', data => {
                if(data.type === 'move') {
                    if(isHost) p2x = data.pos; else p1x = data.pos;
                }
                if(data.type === 'hit') {
                    if(isHost) { hp1 -= 10; createHitEffect('p1'); } 
                    else { hp2 -= 10; createHitEffect('p2'); }
                }
                updateUI();
            });
        }

        // æ ¸å¿ƒæ“ä½œé‚è¼¯ (ç¾åœ¨æ²’é€£ç·šä¹Ÿèƒ½å‹•)
        window.addEventListener('keydown', e => {
            const key = e.key.toLowerCase();
            
            // ç§»å‹•
            if(key === 'a') { isHost ? (p1x -= 15) : (p2x += 15); }
            if(key === 'd') { isHost ? (p1x += 15) : (p2x -= 15); }
            
            // é™åˆ¶é‚Šç•Œ
            if(p1x < 0) p1x = 0; if(p1x > 730) p1x = 730;
            if(p2x < 0) p2x = 0; if(p2x > 730) p2x = 730;

            // æ”»æ“Š
            if(key === 'g') {
                attack();
            }

            // å¦‚æœæœ‰é€£ç·šï¼ŒåŒæ­¥çµ¦å°æ–¹
            if(conn && conn.open) {
                conn.send({ type: 'move', pos: isHost ? p1x : p2x });
            }
            updateUI();
        });

        function attack() {
            // è¨ˆç®—å…©å€‹è§’è‰²çš„å¯¦éš›è·é›¢
            const p1_realX = p1x;
            const p2_realX = 800 - p2x - 70;
            const distance = Math.abs(p1_realX - p2_realX);

            if(distance < 85) {
                if(isHost) {
                    hp2 -= 10;
                    createHitEffect('p2');
                } else {
                    hp1 -= 10;
                    createHitEffect('p1');
                }
                if(conn && conn.open) conn.send({ type: 'hit' });
            }
        }

        function createHitEffect(pid) {
            const p = document.getElementById(pid);
            const eff = document.createElement('div');
            eff.className = 'effect';
            eff.innerText = 'POW!';
            eff.style.left = '10px';
            p.appendChild(eff);
            setTimeout(() => eff.remove(), 500);
        }

        function updateUI() {
            document.getElementById('p1').style.left = p1x + 'px';
            document.getElementById('p2').style.right = p2x + 'px';
            document.getElementById('hp1-fill').style.width = hp1 + '%';
            document.getElementById('hp2-fill').style.width = hp2 + '%';
            
            if(hp1 <= 0 || hp2 <= 0) {
                alert(hp1 <= 0 ? "è—è‰²ç©å®¶ å‹åˆ©ï¼" : "ç´…è‰²ç©å®¶ å‹åˆ©ï¼");
                hp1 = 100; hp2 = 100; updateUI();
            }
        }

        // åˆå§‹æ›´æ–°
        updateUI();
    </script>
</body>
</html>
