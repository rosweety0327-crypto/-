<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>3äººç‹¼äººæ®ºï¼šè‡ªè¨‚æˆ¿è™Ÿç‰ˆ</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #000; color: white; text-align: center; font-family: sans-serif; }
        .btn { background: #e74c3c; color: white; padding: 15px; border-radius: 10px; cursor: pointer; margin: 5px; width: 80%; border:none; font-weight:bold; }
        .box { background: #1a1a1a; padding: 15px; border-radius: 10px; margin: 10px auto; border: 1px solid #444; max-width: 400px; }
        input { padding: 10px; margin: 5px; border-radius: 5px; border: none; width: 70%; text-align: center; font-size: 18px; }
        #board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 10px; }
        .card { background: #333; border: 1px solid #ff00ff; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body>

    <h2 style="color:#ff00ff">ğŸ’€ é ˜ä¸»é€£é–ï¼šè‡ªè¨‚æˆ¿è™Ÿ ğŸ’€</h2>

    <div id="setup">
        <div class="box">
            <p>ç¬¬ä¸€æ­¥ï¼šè¨­å®šä½ çš„æˆ¿è™Ÿ (ä¾‹å¦‚: 888)</p>
            <input id="my-room-id" placeholder="è¼¸å…¥ä½ æƒ³ç•¶æˆ¿è™Ÿçš„æ•¸å­—">
            <button onclick="createRoom()" style="background:#27ae60; color:white; padding:10px; border-radius:5px;">é–‹å•Ÿæˆ¿é–“</button>
            <p id="status" style="color:yellow; font-size:12px;">å°šæœªé–‹æˆ¿</p>
        </div>

        <div class="box">
            <p>ç¬¬äºŒæ­¥ï¼šåŠ å…¥åˆ¥äººçš„æˆ¿é–“</p>
            <input id="join-room-id" placeholder="è¼¸å…¥å°æ–¹çš„æˆ¿è™Ÿ">
            <button onclick="joinRoom()" style="background:#2980b9; color:white; padding:10px; border-radius:5px;">åŠ å…¥æˆ¿é–“</button>
        </div>
        
        <button id="start-btn" class="btn" onclick="start()" style="display:none">âš”ï¸ æˆ¿ä¸»é»æ­¤é–‹æˆ°</button>
    </div>

    <div id="board" style="display:none"></div>

    <script>
        let peer = null, conns = [];

        // ã€åŠŸèƒ½ 1ï¼šå‰µç«‹æˆ¿é–“ã€‘
        function createRoom() {
            let roomId = document.getElementById('my-room-id').value;
            if(!roomId) return alert("è«‹è¼¸å…¥æˆ¿è™Ÿï¼");
            
            // é€™è£¡å°±æ˜¯é—œéµï¼šæŠŠè‡ªè¨‚ ID å‚³çµ¦ Peer
            peer = new Peer('poki-room-' + roomId); 
            
            peer.on('open', id => {
                document.getElementById('status').innerText = "âœ… æˆ¿é–“ " + roomId + " å·²é–‹ï¼Œå¿«å«éšŠå‹é€²ä¾†ï¼";
                document.getElementById('start-btn').style.display = 'block';
            });

            peer.on('error', err => {
                if(err.type === 'unavailable-id') alert("é€™å€‹æˆ¿è™Ÿæœ‰äººç”¨äº†ï¼Œæ›ä¸€å€‹å§ï¼");
                else alert("é€£ç·šéŒ¯èª¤ï¼š" + err.type);
            });

            peer.on('connection', c => {
                conns.push(c);
                c.on('data', d => handle(d));
                alert("éšŠå‹å·²é€£ç·šï¼");
            });
        }

        // ã€åŠŸèƒ½ 2ï¼šåŠ å…¥æˆ¿é–“ã€‘
        function joinRoom() {
            let roomId = document.getElementById('join-room-id').value;
            if(!roomId) return alert("è«‹è¼¸å…¥æˆ¿è™Ÿï¼");
            
            peer = new Peer(); // éš¨æ©Ÿ ID å³å¯
            peer.on('open', () => {
                let c = peer.connect('poki-room-' + roomId);
                conns.push(c);
                c.on('data', d => handle(d));
                document.getElementById('status').innerText = "å˜—è©¦é€£å…¥æˆ¿é–“ " + roomId + "...";
            });
        }

        function start() {
            let players = [{n:"å°å®¥", r:"é è¨€å®¶"}, {n:"å°å¸Œ", r:"ç‹¼äºº"}, {n:"AI1", r:"å¹³æ°‘"}, {n:"AI2", r:"å¹³æ°‘"}, {n:"AI3", r:"å¹³æ°‘"}, {n:"AI4", r:"å¹³æ°‘"}];
            players.sort(() => Math.random() - 0.5);
            let data = { type: 'START', p: players };
            conns.forEach(c => c.send(data));
            handle(data);
        }

        function handle(data) {
            if(data.type === 'START') {
                document.getElementById('setup').style.display = 'none';
                let b = document.getElementById('board');
                b.style.display = 'grid';
                data.p.forEach(p => {
                    b.innerHTML += `<div class="card"><b>${p.n}</b><br><span style="color:cyan">${p.r}</span></div>`;
                });
            }
        }
    </script>
</body>
</html>
